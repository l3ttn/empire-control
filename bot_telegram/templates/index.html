{% extends "base.html" %}

{% block title %}Vis칚o Geral{% endblock %}

{% block content %}
<h2 class="section-title">游늵 Vis칚o Geral</h2>

<div class="stats-grid">
    <div class="stat-card">
        <h3>Total de Conte칰dos</h3>
        <div class="value">{{ total_contents }}</div>
        <div class="change">Ativos no cat치logo</div>
    </div>
    
    <div class="stat-card">
        <h3>Vendas Realizadas</h3>
        <div class="value">{{ total_sales }}</div>
        <div class="change">Total de vendas completas</div>
    </div>
    
    <div class="stat-card">
        <h3>Receita Total</h3>
        <div class="value">R$ {{ "%.2f"|format(total_revenue) }}</div>
        <div class="change">Todas as vendas</div>
    </div>
    
    <div class="stat-card">
        <h3>Entregas Pendentes</h3>
        <div class="value">{{ pending_deliveries }}</div>
        <div class="change">Aguardando entrega</div>
    </div>
</div>

<h3 style="margin-top: 40px; margin-bottom: 20px; font-size: 20px;">游댠 Top 5 Conte칰dos Mais Vendidos</h3>
<table>
    <thead>
        <tr>
            <th>Conte칰do</th>
            <th>Vendas</th>
            <th>Pre칞o Unit치rio</th>
            <th>Receita Total</th>
        </tr>
    </thead>
    <tbody>
        {% for item in top_contents %}
        <tr>
            <td>{{ item.title }}</td>
            <td>{{ item.sales }}</td>
            <td>R$ {{ "%.2f"|format(item.price) }}</td>
            <td><strong>R$ {{ "%.2f"|format(item.revenue) }}</strong></td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" style="text-align: center; color: #6c757d;">Nenhuma venda registrada ainda</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3 style="margin-top: 40px; margin-bottom: 20px; font-size: 20px;">游눯 Vendas Recentes</h3>
<table>
    <thead>
        <tr>
            <th>Data</th>
            <th>Usu치rio ID</th>
            <th>Conte칰do</th>
            <th>Valor</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for sale in recent_sales %}
        <tr>
            <td>{{ sale.purchased_at[:16]|replace('T', ' ') }}</td>
            <td>{{ sale.user_id }}</td>
            <td>{{ sale.content_id }}</td>
            <td>R$ {{ "%.2f"|format(sale.amount) }}</td>
            <td>
                {% if sale.delivered %}
                    <span class="badge badge-success">Entregue</span>
                {% else %}
                    <span class="badge badge-warning">Pendente</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" style="text-align: center; color: #6c757d;">Nenhuma venda registrada ainda</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh stats a cada 30 segundos
    setInterval(() => {
        fetch('/api/stats')
            .then(response => response.json())
            .then(data => {
                console.log('Stats atualizados:', data);
                // Atualizar valores na tela se necess치rio
            });
    }, 30000);
</script>
{% endblock %}

